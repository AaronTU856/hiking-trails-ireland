
{% extends 'advanced_js_mapping/base.html' %}
<!-- Analytics dashboard template for advanced_js_mapping app -->
{% load static %}
{% load humanize %}

{% block title %}Analytics Dashboard{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h1 class="mb-4">
                <i class="fas fa-chart-bar me-2"></i>
                Analytics Dashboard
            </h1>
        </div>
    </div>

    <!-- Summary Cards -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card text-white bg-primary">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">Total Towns</h5>
                            <h2>{{ total_cities|default:0 }}</h2>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-city fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card text-white bg-success">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">Countries</h5>
                            <h2>{{ total_countries|default:0 }}</h2>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-globe fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card text-white bg-info">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">Total Population</h5>
                            <h2>{{ total_population|intcomma|default:"0" }}</h2>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-users fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card text-white bg-warning">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">Recent Searches</h5>
                            <h2>{{ recent_analyses|default:0 }}</h2>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-search fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="row mb-4">
        <div class="col-lg-6 mb-3">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-flag me-2"></i>
                    Towns by County
                    </h5>
                </div>
                <div class="card-body">
                    <canvas id="countriesChart" width="400" height="300"></canvas>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 mb-3">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-pie me-2"></i>
                        Town Types Distribution
                    </h5>
                </div>
                <div class="card-body">
                    <canvas id="cityTypesChart" width="400" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Population Analysis -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-line me-2"></i>
                        Population Distribution
                    </h5>
                </div>
                <div class="card-body">
                    <canvas id="populationChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Tables -->
    <div class="row">
        <div class="col-lg-6 mb-3">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-crown me-2"></i>
                        Top Towns by Population
                    </h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Rank</th>
                                    <th>Town</th>
                                    <th>Country</th>
                                    <th>Population</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for city in top_cities_by_population %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td>{{ city.name }}</td>
                                    <td>{{ city.country }}</td>
                                    <td>{{ city.population|intcomma }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="4" class="text-center text-muted">No data available</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 mb-3">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-dollar-sign me-2"></i>
                        Highest GDP per Capita
                    </h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Rank</th>
                                    <th>Town</th>
                                    <th>Country</th>
                                    <th>GDP/Capita</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for city in top_cities_by_gdp %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td>{{ city.name }}</td>
                                    <td>{{ city.country }}</td>
                                    <td>${{ city.gdp_per_capita|intcomma }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="4" class="text-center text-muted">No data available</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-tools me-2"></i>
                        Quick Actions
                    </h5>
                </div>
                <div class="card-body">
                    <div class="btn-group" role="group">
                        <a href="{% url 'advanced_js_mapping:map' %}" class="btn btn-primary">
                            <i class="fas fa-map me-1"></i>
                            Interactive Map
                        </a>
                        <a href="#" class="btn btn-outline-info" target="_blank">
                            <i class="fas fa-code me-1"></i>
                            Towns API
                        </a>
                        <button class="btn btn-outline-success" onclick="refreshData()">
                            <i class="fas fa-sync me-1"></i>
                            Refresh Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Initialize charts when page loads
document.addEventListener('DOMContentLoaded', function() {
    if (typeof initializeCharts === 'function') initializeCharts();
});

function refreshData() {
    window.location.reload();
}
</script>
{% endblock %}
