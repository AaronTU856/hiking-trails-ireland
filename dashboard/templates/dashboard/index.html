{% extends 'dashboard/base.html' %}
{% load static %}
{% block title %}Dashboard - Irish Trails{% endblock %}

{% block head_extra %}
<!-- Custom Dashboard CSS -->
<style>
    #map { height: 600px; }
    .control-panel {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        margin-bottom: 20px;
    }
    .filter-section {
        border: 1px solid #dee2e6;
        border-radius: 5px;
        padding: 15px;
        margin-bottom: 15px;
    }
    .layer-toggle {
        margin: 5px 0;
    }
    .stats-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 15px;
    }
    .export-btn {
        margin: 5px;
    }
    .loading {
        display: none;
        text-align: center;
        padding: 20px;
    }
    .feature-info {
        position: absolute;
        bottom: 10px;
        left: 10px;
        background: rgba(255,255,255,0.9);
        padding: 10px;
        border-radius: 5px;
        display: none;
        max-width: 300px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid mt-3">
        <div class="row">
            <!-- Control Panel -->
            <div class="col-md-3">
                <div class="control-panel">
                    <h5>üìä Data Overview</h5>
                    <div class="stats-card">
                        <h6>Total Trails: <span id="total-trails">{{ total_trails }}</span></h6>
                        <h6>Total Towns: <span id="total-towns">{{ total_towns }}</span></h6>
                    </div>

                    <!-- Layer Controls -->
                    <div class="filter-section">
                        <h6>üó∫Ô∏è Map Layers</h6>
                        <div class="layer-toggle">
                            <input type="checkbox" id="show-trails" checked>
                            <label for="show-trails">Show Trails</label>
                        </div>
                        <div class="layer-toggle">
                            <input type="checkbox" id="show-towns" checked>
                            <label for="show-towns">Show Towns</label>
                        </div>
                        <div class="layer-toggle">
                            <input type="checkbox" id="cluster-trails">
                            <label for="cluster-trails">Cluster Trails</label>
                        </div>
                    </div>

                    <!-- Trail Filters -->
                    <div class="filter-section">
                        <h6>üë• Trail Filters</h6>
                        <div class="mb-2">
                            <label class="form-label">Trail Length</label>
                            <div class="row">
                                <div class="col-6">
                                    <input type="number" id="trail-length-min" class="form-control form-control-sm" 
                                           placeholder="Min" value="0">
                                </div>
                                <div class="col-6">
                                    <input type="number" id="trail-length-max" class="form-control form-control-sm" 
                                           placeholder="Max">
                                </div>
                            </div>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Trail Difficulty</label>
                            <select id="trail-difficulty-min" class="form-select form-select-sm">
                              <option value="">All Difficulties</option>
                              <option value="easy">Easy</option>
                              <option value="moderate">Moderate</option>
                              <option value="hard">Hard</option>
                            </select>
                          </div>
                    </div>

                    <!-- Town Filters -->
                    <div class="filter-section">
                        <h6>üìè Town Filters</h6>
                      
                        <!-- Town Population -->
                        <div class="mb-3">
                          <label class="form-label fw-semibold">Population Range</label>
                          <div class="row g-2">
                            <div class="col-6">
                              <input
                                type="number"
                                id="town-pop-min"
                                class="form-control form-control-sm"
                                placeholder="Min"
                                min="0"
                              >
                            </div>
                            <div class="col-6">
                              <input
                                type="number"
                                id="town-pop-max"
                                class="form-control form-control-sm"
                                placeholder="Max"
                                min="0"
                              >
                            </div>
                          </div>
                        </div>
                      
                        <!-- Town Type -->
                        <div class="mb-2">
                          <label class="form-label">Town Type</label>
                          <select id="town-type-filter" class="form-select form-select-sm">
                            <option value="">All Types</option>
                            <option value="Historic">Historic</option>
                            <option value="Village">Village</option>
                            <option value="Urban">Urban</option>
                          </select>
                        </div>
                      </div>


                    
                    <!-- üèõÔ∏è Category Filters -->
                    <div class="filter-section">
                        <h6>üèõÔ∏è Category Filters</h6>
                    
                        <div class="mb-2">
                        <label class="form-label">County</label>
                        <select id="country-filter" class="form-select form-select-sm">
                            <option value="">All Counties</option>
                            {% for country in countries %}
                            <option value="{{ country }}">{{ country }}</option>
                            {% endfor %}
                        </select>
                        </div>
                    
                        <div class="mb-2">
                            <label class="form-label">Trail Type</label>
                            <select id="trail-type-filter" class="form-select form-select-sm">
                              <option value="">All Types</option>
                              <option value="Walking Trail">Walking Trail</option>
                              <option value="Road Cycling Trail">Road Cycling Trail</option>
                              <option value="Off Road Cycling Trail">Off Road Cycling Trail</option>
                              <option value="Blueway">Blueway</option>
                            </select>
                          </div>
                          
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-grid gap-2">
                        <button id="apply-filters" class="btn btn-primary">Apply Filters</button>
                        <button id="clear-filters" class="btn btn-outline-secondary">Clear All</button>
                    </div>

                    <!-- Export Options -->
                    <div class="filter-section">
                        <h6>üì• Export Data</h6>
                        <button id="export-trails" class="btn btn-outline-success export-btn">Trails GeoJSON</button>
                        <button id="export-towns" class="btn btn-outline-success export-btn">Towns GeoJSON</button>
                        <button id="export-statistics" class="btn btn-outline-info export-btn">Statistics</button>
                    </div>
                </div>
            </div>

            <!-- Map Container -->
            <div class="col-md-9">
                <div class="position-relative">
                    <div id="map"></div>
                    <div class="loading" id="loading">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p>Loading data...</p>
                    </div>
                    <div class="feature-info" id="feature-info">
                        <!-- Feature details will be displayed here -->
                    </div>
                </div>

                <!-- Results Summary -->
                <div class="mt-3">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <h5 class="card-title">Trails Displayed</h5>
                                    <h3 class="text-primary" id="trails-count">0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <h5 class="card-title">Towns Displayed</h5>
                                    <h3 class="text-success" id="towns-count">0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <h5 class="card-title">Total Population</h5>
                                    <h3 class="text-info" id="total-population">0</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}

    <!-- ‚úÖ Load the external map script -->
    <script src="{% static 'dashboard/js/dashboard_map.js' %}"></script>


{% endblock %}




   