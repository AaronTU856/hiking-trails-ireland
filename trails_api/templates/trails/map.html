{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trails Map - Proximity Search</title>

  <!-- âœ… CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="{% static 'trails_api/css/leaflet-search.min.css' %}">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <link rel="stylesheet" href="{% static 'css/global-theme.css' %}">

  
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
    }

    .main-container {
      display: flex;
      height: calc(100vh - 56px);
      gap: 0;
    }

    .sidebar {
      width: 320px;
      background: #f8f9fa;
      border-right: 1px solid #dee2e6;
      overflow-y: auto;
      padding: 16px;
      box-shadow: 2px 0 4px rgba(0,0,0,0.1);
      z-index: 100;
    }

    .sidebar .card {
      margin-bottom: 12px;
      border: 1px solid #dee2e6;
    }

    .sidebar .card-header {
      background-color: #e9ecef;
      border-bottom: 1px solid #dee2e6;
      font-weight: 600;
      padding: 10px 12px;
    }

    .sidebar .card-body {
      padding: 12px;
    }

    #map-container {
      flex: 1;
      position: relative;
    }

    #map { 
      height: 100%;
      width: 100%; 
    }
    
    /* POI Marker Styles */
    .poi-marker {
      background: none;
      border: none;
    }
    
    .leaflet-popup-content {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }
    
    /* POI Control Panel */
    .poi-control {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      padding: 12px;
    }

    .sidebar h6 {
      font-size: 13px;
      font-weight: 600;
      color: #2c3e50;
      margin: 0 0 10px 0;
    }

    .sidebar label {
      font-size: 12px;
      margin-bottom: 6px;
    }

    .sidebar input, .sidebar select {
      font-size: 12px;
    }

    .sidebar button {
      font-size: 12px;
      margin-top: 6px;
    }

    /* Scrollbar styling */
    .sidebar::-webkit-scrollbar {
      width: 6px;
    }

    .sidebar::-webkit-scrollbar-track {
      background: #f1f1f1;
    }

    .sidebar::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 3px;
    }

    .sidebar::-webkit-scrollbar-thumb:hover {
      background: #555;
    }

    /* Results panel in map */
    #trail-results {
      max-width: 280px !important;
    }

    /* Search control positioning - force to topleft beside zoom */
    .leaflet-top.leaflet-left .leaflet-control-search {
      position: absolute !important;
      float: none !important;
      left: 50px !important;
      top: 10px !important;
      margin: 0 !important;
      right: auto !important;
    }

    .leaflet-control-search.search-exp {
      position: absolute !important;
      left: 50px !important;
      top: 10px !important;
      margin: 0 !important;
      right: auto !important;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid">
      <div style="display: flex; align-items: center; gap: 12px;">
        <span class="navbar-brand">ğŸ¥¾ Irish Trails Map</span>
        <a class="top-back" href="/" onclick="if (history.length>1){ history.back(); return false; }">
          â† Back
        </a>
      </div>
    </div>
  </nav>

  <!-- Quick Navigation -->
  <div style="display:flex;gap:12px;flex-wrap:wrap;margin:12px;padding:0 12px;">
    <a href="/" style="padding:12px 18px;background:var(--brand-primary,#2E8B57);color:#fff;border-radius:8px;text-decoration:none;">ğŸ  Home</a>
    <a href="/dashboard/" style="padding:12px 18px;background:#8B4513;color:#fff;border-radius:8px;text-decoration:none;">ğŸ“Š Dashboard</a>
    <a href="{% url 'advanced_js_mapping:map' %}" style="padding:12px 18px;background:#2E27F5;color:#fff;border-radius:8px;text-decoration:none;">ğŸ—ºï¸ Interactive Map</a>
    <a href="{% url 'advanced_js_mapping:index' %}" style="padding:12px 18px;background:#F5273F;color:#fff;border-radius:8px;text-decoration:none;">ğŸ¨ Accommodations</a>
    <a href="{% url 'advanced_js_mapping:analytics' %}" style="padding:12px 18px;background:#FFB86B;color:#111;border-radius:8px;text-decoration:none;">ğŸ“ˆ Analytics</a>
    <a href="/admin/" style="padding:12px 18px;background:#34495E;color:#fff;border-radius:8px;text-decoration:none;">âš™ï¸ Admin</a>
  </div>

  <!-- âœ… Map Container with Sidebar -->
  <div class="main-container">
    <!-- Left Sidebar -->
    <div class="sidebar">
      <h5 style="margin-bottom: 16px; color: #2c3e50;">ğŸ—ºï¸ Search & Explore</h5>

      <!-- Trails within radius -->
      <div class="card">
        <div class="card-header">ğŸ“ Trails within radius</div>
        <div class="card-body">
          <input id="radius-input" type="number" class="form-control form-control-sm mb-2" value="50" min="1" max="500" placeholder="Radius (m)"/>
          <button id="toggle-search" class="btn btn-success btn-sm w-100">Enable Search</button>
          <small class="text-muted d-block mt-2">Select a trail marker to see details. Select a town marker for weather.</small>
        </div>
      </div>

      <!-- Points of Interest -->
      <div class="card">
        <div class="card-header">ğŸ“ Points of Interest</div>
        <div class="card-body" id="poi-controls">
          <div id="poi-checkboxes"></div>
          <button id="load-all-pois-btn" class="btn btn-sm btn-success w-100 mt-2">Load All POIs</button>
        </div>
      </div>

      <!-- Spatial Analysis -->
      <div class="card">
        <div class="card-header">ğŸ“Š Spatial Analysis</div>
        <div class="card-body">
          <button id="analysis-btn" class="btn btn-sm btn-success w-100">Generate Report</button>
          <div id="analysis-results" style="font-size: 11px; margin-top: 8px;"></div>
        </div>
      </div>

      <!-- Rivers Info -->
      <div class="card">
        <div class="card-header">ğŸŒŠ Rivers</div>
        <div class="card-body">
          <p style="font-size: 12px; color: #666; margin: 0;">
            2,758 rivers across Ireland. Click any river to:
          </p>
          <ul style="font-size: 11px; margin: 8px 0 0 0; padding-left: 18px; color: #666;">
            <li><strong>Show trails crossing</strong> - Find intersecting trails</li>
            <li><strong>Show nearby trails (5km)</strong> - Trails within 5km radius</li>
          </ul>
        </div>
      </div>

      <!-- Legend -->
      <div class="card">
        <div class="card-header">ğŸ¨ Legend</div>
        <div class="card-body" style="font-size: 11px;">
          <div style="margin-bottom: 8px;">
            <span style="display: inline-block; width: 20px; height: 3px; background: #FF8C00; margin-right: 8px;"></span>
            <strong>Trail</strong>
          </div>
          <div style="margin-bottom: 8px;">
            <span style="display: inline-block; width: 20px; height: 3px; background: #1e90ff; margin-right: 8px;"></span>
            <strong>River</strong>
          </div>
          <div style="margin-bottom: 8px;">
            <span style="display: inline-block; width: 12px; height: 12px; background: #FF0000; border-radius: 50%; margin-right: 8px;"></span>
            <strong>Crossing Trail</strong>
          </div>
          <div>
            <span style="display: inline-block; width: 12px; height: 12px; background: #FFCC00; border: 2px solid #FF9F1C; border-radius: 50%; margin-right: 8px;"></span>
            <strong>Nearby Trail</strong>
          </div>
        </div>
      </div>
    </div>

    <!-- Map Container -->
    <div id="map-container">
      <div id="map"></div>

      <!-- Results panel (stays on map) -->
      <div id="trail-results"
           class="position-absolute bottom-0 start-0 bg-white p-2 m-3 rounded shadow"
           style="z-index:1000; max-height: 40vh; overflow-y: auto; display: none;">
        <button class="btn btn-sm btn-close" onclick="document.getElementById('trail-results').style.display='none';" style="position: absolute; top: 5px; right: 5px;"></button>
        <small class="text-muted">Search results will appear here</small>
      </div>
    </div>
  </div>
  
<!-- âœ… JavaScript order -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="{% static 'trails_api/js/leaflet-search.min.js' %}"></script>

<!-- âœ… Main map logic must come last) -->
<script src="{% static 'trails_api/js/trails_map.js' %}"></script>

<!-- âœ… POI and Boundary visualization -->
<script src="{% static 'trails_api/js/pois_boundaries.js' %}"></script>

<!-- Footer -->
    <footer class="bg-light text-center py-4 mt-5">
        <img src="{% static 'images/logo.png' %}" alt="Stay and Trek Logo" style="height: 100px; margin-bottom: 14px;">
        <p class="mb-0">&copy; Stay and Trek Hiking 2025</p>
    </footer>

</body>
</html>
